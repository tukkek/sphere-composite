<!doctype HTML>
<title>Sphere compositer</title>

<style>
  body{margin:0;}
  canvas{display:block;}
  #controls{
    position:absolute;
    top:10px;
    left:10px;
    background:rgba(0,0,0,0.7);
    color:white;
    padding:10px;
    border-radius:5px;
  }
</style>

<div id="controls">
  <div>
    <label for="size">Sphere Size: </label>
    <input type="range" id="size" min="0.1" max="2" value="1" step="0.1">
  </div>
  <div>
    <label for="textureScale">Texture Scale: </label>
    <input type="range" id="textureScale" min="0.1" max="5" value="1" step="0.1">
  </div>
  <div>
    <label for="texture">Choose Texture: </label>
    <input type="file" id="texture" accept="image/*">
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script>
  var scene=new THREE.Scene()
  var camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,0.1,1000)
  var renderer=new THREE.WebGLRenderer()
  var sliders=Array.from(document.querySelectorAll('input[type="range"]'))
  var texturer=document.querySelector('#texture')
  var sphere=new THREE.Mesh(new THREE.SphereGeometry(5,32,32),new THREE.MeshBasicMaterial({'color':0xcccccc}))
  var texture=false
  var cursor=[0,0]

  function resize(){
    let width=window.innerWidth
    let height=window.innerHeight
    camera.aspect=width/height
    camera.updateProjectionMatrix()
    renderer.setSize(width,height)
  }

  function scale(){
    let scale=sliders.map((slider)=>parseFloat(slider.value))
    sphere.scale.set(scale[0],scale[0],scale[0])
    if(!texture) return
    texture.repeat.set(scale[1],scale[1])
    texture.needsUpdate=true
  }

  function wrap(){
    let file=texturer.files[0]
    if(!file) return
    let reader=new FileReader()
    reader.onload=(event)=>{
      loader.load(event.target.result,(texture2)=>{
        texture2.wrapS=texture2.wrapT=THREE.RepeatWrapping
        texture2.repeat.set(parseFloat(sliders[1].value),parseFloat(sliders[1].value))
        sphere.material=new THREE.MeshBasicMaterial({map:texture2})
        sphere.material.needsUpdate=true
        texture=texture2
      })
    }
    reader.readAsDataURL(file)
  }

  function animate(){
    requestAnimationFrame(animate)
    let rotation=sphere.rotation
    rotation.y=cursor[0]*Math.PI
    rotation.x=cursor[1]*Math.PI
    renderer.render(scene,camera)
  }

  renderer.setSize(window.innerWidth,window.innerHeight)
  document.body.appendChild(renderer.domElement)
  scene.add(sphere)
  camera.position.z=10
  window.addEventListener('resize',resize)
  sliders[0].addEventListener('input',scale)
  sliders[1].addEventListener('input',scale)
  let loader=new THREE.TextureLoader()
  texturer.addEventListener('change',wrap)
  document.addEventListener('mousemove',(e)=>cursor=[(e.clientX/window.innerWidth)*2-1,(e.clientY/window.innerHeight)*2+1])
  animate()
</script>
